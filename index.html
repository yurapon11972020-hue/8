<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>–ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è —Å 8 –º–∞—Ä—Ç–∞ | –ö–æ–ª–ª–µ–¥–∂</title>
    <style>
        /* ========== –°–û–í–†–ï–ú–ï–ù–ù–´–ô –ñ–ï–ù–°–¢–í–ï–ù–ù–´–ô –î–ò–ó–ê–ô–ù ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @import url('https://fonts.googleapis.com/css2?family=Inter:opsz@14..32&family=Playfair+Display:wght@400;600;700&display=swap');

        body {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 16px;
            font-family: 'Inter', sans-serif;
            background: #fce7f0;
            position: relative;
            overflow-x: hidden;
            transition: background-color 0.5s, color 0.3s;
            animation: bodyFadeIn 1s ease;
        }

        @keyframes bodyFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        body::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 20% 30%, rgba(255, 200, 220, 0.4) 0%, transparent 30%),
                        radial-gradient(circle at 80% 70%, rgba(255, 180, 200, 0.4) 0%, transparent 35%),
                        radial-gradient(circle at 40% 80%, #ffd9e5 0%, transparent 40%);
            filter: blur(60px);
            z-index: 0;
            animation: floatBg 20s ease-in-out infinite alternate;
        }

        @keyframes floatBg {
            0% { transform: scale(1) translate(0, 0); opacity: 0.7; }
            100% { transform: scale(1.2) translate(-2%, -2%); opacity: 1; }
        }

        body.dark-theme {
            background: #0a0a0a;
        }
        body.dark-theme::before {
            display: none;
        }

        .container {
            width: 100%;
            max-width: 1300px;
            border-radius: 48px;
            overflow: hidden;
            display: flex;
            flex-direction: row;
            min-height: 600px;
            background: rgba(255, 250, 250, 0.3);
            backdrop-filter: blur(16px) saturate(180%);
            -webkit-backdrop-filter: blur(16px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.3) inset;
            z-index: 10;
            position: relative;
            transition: background 0.4s, border-color 0.3s, transform 0.3s;
            animation: containerScaleIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes containerScaleIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        body.dark-theme .container {
            background: rgba(20, 20, 20, 0.8);
            backdrop-filter: blur(20px) saturate(150%);
            border-color: rgba(151, 154, 170, 0.3);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.7);
        }

        .sidebar {
            width: 220px;
            padding: 30px 0 80px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            border-right: 1px solid rgba(255, 182, 193, 0.4);
            background: rgba(255, 240, 245, 0.2);
            backdrop-filter: blur(10px);
            position: relative;
        }

        body.dark-theme .sidebar {
            background: rgba(30, 30, 30, 0.5);
            border-right-color: rgba(151, 154, 170, 0.3);
        }

        .sidebar button {
            width: 160px;
            padding: 14px 12px;
            border: none;
            font-size: 16px;
            font-weight: 500;
            border-radius: 60px;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            color: #b3435e;
            box-shadow: 0 8px 20px rgba(255, 160, 180, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.6);
            font-weight: 600;
            letter-spacing: 0.3px;
            position: relative;
            overflow: hidden;
        }

        .sidebar button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
        }

        .sidebar button:hover::after {
            width: 200px;
            height: 200px;
        }

        .sidebar button:hover {
            transform: translateY(-3px) scale(1.02);
            background: #ffb6c9;
            color: white;
            box-shadow: 0 15px 25px rgba(255, 120, 160, 0.4);
            border-color: #ffb6c9;
        }

        .sidebar button.active {
            background: linear-gradient(135deg, #ff8da1, #ffb3c6);
            color: white;
            border-color: white;
            box-shadow: 0 10px 20px rgba(255, 80, 140, 0.3);
        }

        .sidebar button.active::after {
            display: none;
        }

        body.dark-theme .sidebar button {
            background: #979aaa;
            color: #ffffff;
            border-color: #b0b5c5;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
        }

        body.dark-theme .sidebar button::after {
            background: rgba(255, 255, 255, 0.2);
        }

        body.dark-theme .sidebar button:hover {
            background: #aab0c0;
            color: white;
            border-color: #c0c5d5;
        }

        body.dark-theme .sidebar button.active {
            background: #7e8494;
            color: white;
            border-color: #979aaa;
        }

        .moderation-circle {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: linear-gradient(145deg, #ffb3c6, #ff8da1);
            border: 3px solid white;
            box-shadow: 0 10px 25px rgba(255, 80, 140, 0.4);
            font-size: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.3s;
            z-index: 30;
            color: white;
            animation: pulseModeration 2s infinite;
        }

        @keyframes pulseModeration {
            0% { box-shadow: 0 0 0 0 rgba(255, 141, 161, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(255, 141, 161, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 141, 161, 0); }
        }

        .moderation-circle:hover {
            transform: translateX(-50%) scale(1.1) rotate(5deg);
            background: linear-gradient(145deg, #ffc0d0, #ff7088);
            box-shadow: 0 15px 30px rgba(255, 0, 100, 0.5);
            animation: none;
        }

        body.dark-theme .moderation-circle {
            background: #979aaa;
            border-color: #ffffff;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6);
            animation: pulseModerationDark 2s infinite;
        }

        @keyframes pulseModerationDark {
            0% { box-shadow: 0 0 0 0 #979aaa; }
            70% { box-shadow: 0 0 0 15px rgba(151, 154, 170, 0); }
            100% { box-shadow: 0 0 0 0 rgba(151, 154, 170, 0); }
        }

        body.dark-theme .moderation-circle:hover {
            background: #aab0c0;
            animation: none;
        }

        .content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            position: relative;
            z-index: 11;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            scrollbar-width: thin;
            scrollbar-color: #ffb3c6 #ffe4e9;
            animation: contentFadeIn 0.8s ease;
        }

        @keyframes contentFadeIn {
            from { opacity: 0; transform: translateX(10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .content::-webkit-scrollbar {
            width: 8px;
        }
        .content::-webkit-scrollbar-track {
            background: #ffe4e9;
            border-radius: 20px;
        }
        .content::-webkit-scrollbar-thumb {
            background: #ffb3c6;
            border-radius: 20px;
            border: 2px solid #ffe4e9;
        }

        body.dark-theme .content {
            scrollbar-color: #979aaa #2a2a2a;
        }
        body.dark-theme .content::-webkit-scrollbar-track {
            background: #2a2a2a;
        }
        body.dark-theme .content::-webkit-scrollbar-thumb {
            background: #979aaa;
            border-color: #2a2a2a;
        }

        .theme-toggle {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 20;
            border: none;
            border-radius: 50%;
            width: 54px;
            height: 54px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 28px;
            transition: 0.4s;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.8);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            animation: themePulse 3s infinite;
        }

        @keyframes themePulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 141, 161, 0.5); }
            50% { box-shadow: 0 0 0 10px rgba(255, 141, 161, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 141, 161, 0); }
        }

        .theme-toggle:hover {
            transform: rotate(30deg) scale(1.15);
            background: white;
            box-shadow: 0 12px 28px rgba(255, 150, 200, 0.6);
            animation: none;
        }

        body.dark-theme .theme-toggle {
            background: #979aaa;
            border-color: #b0b5c5;
            color: #ffffff;
        }

        body.dark-theme .theme-toggle:hover {
            background: #aab0c0;
        }

        h1, h2 {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #c1506a, #ff8da1, #c1506a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
            font-size: 2.4rem;
            text-shadow: 0 2px 10px rgba(255, 120, 160, 0.3);
            animation: titleGlow 3s infinite alternate;
        }

        @keyframes titleGlow {
            from { text-shadow: 0 2px 10px rgba(255, 120, 160, 0.3); }
            to { text-shadow: 0 4px 20px rgba(255, 120, 160, 0.6); }
        }

        h2 {
            font-size: 1.9rem;
        }

        body.dark-theme h1, body.dark-theme h2 {
            background: none;
            -webkit-text-fill-color: #f0f0f0;
            color: #f0f0f0;
            text-shadow: none;
            animation: none;
        }

        .stats, .rules {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(12px);
            border-radius: 60px;
            padding: 20px 28px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 15px 30px rgba(255, 150, 180, 0.15);
            color: #4a2a35;
            transition: 0.3s;
            animation: slideInUp 0.6s ease;
        }

        .stats {
            display: flex;
            gap: 32px;
            font-weight: 600;
        }

        .rules {
            border-left: 6px solid #ff8da1;
        }

        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats:hover, .rules:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(255, 130, 160, 0.25);
        }

        body.dark-theme .stats, body.dark-theme .rules {
            background: rgba(30, 30, 30, 0.8);
            border-color: rgba(151, 154, 170, 0.3);
            color: #e0e0e0;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
        }
        body.dark-theme .rules {
            border-left-color: #979aaa;
        }

        .form-group {
            margin-bottom: 24px;
            animation: formAppear 0.5s ease backwards;
        }

        .form-group:nth-child(1) { animation-delay: 0.1s; }
        .form-group:nth-child(2) { animation-delay: 0.2s; }
        .form-group:nth-child(3) { animation-delay: 0.3s; }
        .form-group:nth-child(4) { animation-delay: 0.4s; }

        @keyframes formAppear {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #a0475e;
            letter-spacing: 0.3px;
            transition: color 0.3s;
        }

        input, textarea, select {
            width: 100%;
            padding: 16px 24px;
            border: none;
            border-radius: 60px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            transition: 0.3s;
            color: #3a2a30;
            font-weight: 500;
        }

        textarea {
            border-radius: 30px;
            min-height: 130px;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            background: white;
            border-color: #ff8da1;
            box-shadow: 0 0 0 4px rgba(255, 141, 161, 0.3);
            transform: scale(1.01);
        }

        body.dark-theme label {
            color: #ccc;
        }

        body.dark-theme input, body.dark-theme textarea, body.dark-theme select {
            background: #979aaa;
            border-color: #b0b5c5;
            color: #ffffff;
        }

        body.dark-theme input:focus, body.dark-theme textarea:focus, body.dark-theme select:focus {
            background: #aab0c0;
            border-color: #ffffff;
            box-shadow: 0 0 0 4px rgba(151, 154, 170, 0.3);
        }

        button[type="submit"], .search-btn, .approve-btn, .delete-btn, .edit-btn, .save-btn, .cancel-btn, .logout-btn, .load-more, .like-btn, .share-btn {
            border: none;
            padding: 14px 28px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 60px;
            cursor: pointer;
            transition: 0.3s;
            margin-right: 8px;
            margin-top: 8px;
            background: linear-gradient(145deg, #ffb3c6, #ff8da1);
            color: white;
            box-shadow: 0 8px 18px rgba(255, 100, 150, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.5);
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            animation: buttonPop 0.4s ease;
        }

        @keyframes buttonPop {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        button[type="submit"]::after, .search-btn::after, .approve-btn::after, .delete-btn::after, .edit-btn::after, .save-btn::after, .cancel-btn::after, .logout-btn::after, .load-more::after, .like-btn::after, .share-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
        }

        button[type="submit"]:hover::after, .search-btn:hover::after, .approve-btn:hover::after, .delete-btn:hover::after, .edit-btn:hover::after, .save-btn:hover::after, .cancel-btn:hover::after, .logout-btn:hover::after, .load-more:hover::after, .like-btn:hover::after, .share-btn:hover::after {
            width: 300px;
            height: 300px;
        }

        button:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 25px rgba(255, 80, 140, 0.5);
            background: linear-gradient(145deg, #ffc0d0, #ff7088);
        }

        button:disabled {
            opacity: 0.5;
            transform: none;
            box-shadow: none;
            background: #cccccc;
        }

        body.dark-theme button:not(.theme-toggle):not(.moderation-circle) {
            background: #979aaa;
            color: #ffffff;
            box-shadow: 0 8px 18px rgba(0, 0, 0, 0.5);
            border-color: #b0b5c5;
        }
        body.dark-theme button:hover:not(.theme-toggle):not(.moderation-circle) {
            background: #aab0c0;
        }

        .delete-btn { background: #e5738c; }
        .edit-btn { background: #a5b8e0; }
        .save-btn { background: #c8a2c8; }
        .cancel-btn { background: #cfa5b4; }
        .load-more { background: #d8a7b0; }

        body.dark-theme .delete-btn { background: #b38f8f; }
        body.dark-theme .edit-btn { background: #8f9fb0; }
        body.dark-theme .save-btn { background: #9f8fb0; }
        body.dark-theme .cancel-btn { background: #b08f9f; }
        body.dark-theme .load-more { background: #8f9fb0; }

        .message {
            margin-top: 20px;
            padding: 16px 24px;
            border-radius: 60px;
            display: none;
            font-weight: 600;
            text-align: center;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid white;
            animation: messageSlide 0.3s ease;
        }

        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.success {
            background: rgba(212, 237, 218, 0.8);
            color: #0e4e1f;
        }
        .message.error {
            background: rgba(248, 215, 218, 0.8);
            color: #711c24;
        }
        body.dark-theme .message.success {
            background: #2a3a2a;
            color: #a0d0a0;
        }
        body.dark-theme .message.error {
            background: #3a2a2a;
            color: #ffa0a0;
        }

        .result-item {
            border-radius: 40px;
            padding: 28px;
            margin-bottom: 24px;
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 15px 35px rgba(255, 130, 160, 0.2);
            transition: 0.4s;
            border-left: 8px solid #ff8da1;
            animation: fadeInUp 0.5s ease;
            animation-fill-mode: both;
        }

        .result-item:nth-child(1) { animation-delay: 0.1s; }
        .result-item:nth-child(2) { animation-delay: 0.2s; }
        .result-item:nth-child(3) { animation-delay: 0.3s; }
        .result-item:nth-child(4) { animation-delay: 0.4s; }
        .result-item:nth-child(5) { animation-delay: 0.5s; }
        .result-item:nth-child(6) { animation-delay: 0.6s; }
        .result-item:nth-child(7) { animation-delay: 0.7s; }
        .result-item:nth-child(8) { animation-delay: 0.8s; }
        .result-item:nth-child(9) { animation-delay: 0.9s; }
        .result-item:nth-child(10) { animation-delay: 1s; }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-item:hover {
            transform: translateY(-5px) scale(1.01);
            background: rgba(255, 240, 245, 0.7);
            border-color: white;
            box-shadow: 0 25px 45px rgba(255, 80, 130, 0.25);
        }

        body.dark-theme .result-item {
            background: rgba(40, 40, 40, 0.8);
            border-color: rgba(151, 154, 170, 0.3);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.7);
            border-left-color: #979aaa;
        }

        body.dark-theme .result-item:hover {
            background: rgba(60, 60, 60, 0.8);
            border-color: #aab0c0;
        }

        .result-item p {
            margin: 8px 0;
            font-size: 16px;
            color: #3a2a30;
            font-weight: 500;
        }

        body.dark-theme .result-item p {
            color: #e0e0e0;
        }

        .result-item strong {
            color: #b3435e;
        }

        body.dark-theme .result-item strong {
            color: #ffffff;
        }

        .no-results, .search-hint {
            text-align: center;
            font-style: italic;
            padding: 40px;
            background: rgba(255, 240, 245, 0.6);
            backdrop-filter: blur(12px);
            border-radius: 60px;
            color: #a76e7c;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        body.dark-theme .no-results, body.dark-theme .search-hint {
            background: rgba(40, 40, 40, 0.8);
            color: #ccc;
        }

        .search-container {
            margin-bottom: 30px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            animation: slideInRight 0.5s ease;
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .search-container input {
            flex: 1;
            min-width: 250px;
        }

        .sort-container {
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 12px 24px;
            border-radius: 60px;
            animation: zoomIn 0.5s ease;
        }

        @keyframes zoomIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .sort-container label {
            margin-bottom: 0;
            color: #a0475e;
        }
        .sort-container select {
            width: auto;
            min-width: 220px;
        }
        body.dark-theme .sort-container {
            background: rgba(40, 40, 40, 0.5);
        }
        body.dark-theme .sort-container label {
            color: #ccc;
        }

        .moderation-tabs {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 25px;
            animation: tabsFade 0.5s ease;
        }

        @keyframes tabsFade {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .moderation-tabs button {
            padding: 14px 28px;
            border-radius: 40px;
            font-weight: 600;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(10px);
            border: 1px solid white;
            color: #b3435e;
            transition: 0.3s;
        }

        .moderation-tabs button.active-tab {
            background: linear-gradient(145deg, #ff8da1, #ffb3c6);
            color: white;
            border-color: white;
        }

        .moderation-tabs button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 141, 161, 0.3);
        }

        body.dark-theme .moderation-tabs button {
            background: #979aaa;
            color: #ffffff;
            border-color: #b0b5c5;
        }
        body.dark-theme .moderation-tabs button.active-tab {
            background: #7e8494;
            color: white;
            border-color: #979aaa;
        }

        .inline-edit-input {
            width: 100%;
            margin: 8px 0;
            padding: 14px 18px;
            border-radius: 40px;
            border: 1px solid #ffb6c1;
            background: white;
            transition: 0.3s;
        }

        .inline-edit-input:focus {
            outline: none;
            border-color: #ff8da1;
            box-shadow: 0 0 0 3px rgba(255, 141, 161, 0.2);
            transform: scale(1.01);
        }

        body.dark-theme .inline-edit-input {
            background: #979aaa;
            color: white;
            border-color: #b0b5c5;
        }

        .timer-message {
            margin-top: 10px;
            font-weight: 600;
            color: #a0475e;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }

        body.dark-theme .timer-message {
            color: #ccc;
        }

        .heart-animation {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            font-size: 28px;
            animation: floatUp 2s cubic-bezier(0.5, 0, 0.5, 1) forwards;
            filter: drop-shadow(0 0 10px #ff8da1);
        }

        body.dark-theme .heart-animation {
            filter: drop-shadow(0 0 10px #979aaa);
        }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(0.8) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-250px) scale(1.8) rotate(20deg); opacity: 0; }
        }

        /* ===== –ü–∞—Å—Ö–∞–ª–∫–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ (–ø—Ä–æ—Å—Ç–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –∏ fadeOut) ===== */
        .easter-egg-img {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 70vw;
            max-height: 70vh;
            z-index: 10000;
            display: none;
            pointer-events: none;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
        }

        .easter-egg-img.show {
            display: block;
            opacity: 1;
        }

        .easter-egg-img.hide {
            opacity: 0;
        }

        /* ========== –ú–û–ë–ò–õ–¨–ù–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø ========== */
        @media (max-width: 768px) {
            body { padding: 8px; }
            .container { flex-direction: column; border-radius: 36px; }
            .sidebar {
                width: 100%;
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                padding: 20px 8px 90px 8px;
                gap: 10px;
                border-right: none;
                border-bottom: 1px solid rgba(255,182,193,0.5);
            }
            .sidebar button {
                width: auto;
                min-width: 110px;
                padding: 16px 10px;
                font-size: 16px;
                flex: 1 1 auto;
                margin: 0 4px;
            }
            .moderation-circle {
                bottom: 16px;
                width: 60px;
                height: 60px;
                font-size: 32px;
            }
            .content { padding: 28px; }
            h1 { font-size: 32px; }
            h2 { font-size: 26px; }
            .stats { flex-direction: column; gap: 10px; padding: 20px; font-size: 18px; }
            .rules { padding: 20px; font-size: 16px; }
            .form-group input,
            .form-group textarea,
            .form-group select {
                padding: 18px 24px;
                font-size: 18px;
            }
            button[type="submit"], .search-btn, .approve-btn, .delete-btn, .edit-btn,
            .save-btn, .cancel-btn, .logout-btn, .load-more {
                padding: 18px 20px;
                font-size: 18px;
                width: 100%;
                margin-right: 0;
                margin-top: 10px;
            }
            .load-more {
                width: auto;
                min-width: 220px;
                padding: 16px 24px;
                font-size: 18px;
                margin: 15px auto 0;
            }
            .like-btn, .share-btn {
                width: 100%;
                margin-right: 0;
                margin-bottom: 10px;
                font-size: 18px;
                padding: 16px 12px;
            }
            .search-container { flex-direction: column; gap: 12px; }
            .search-container input {
                width: 100%;
                font-size: 18px;
                padding: 18px;
            }
            .result-item { padding: 24px; margin-bottom: 20px; }
            .result-item p { font-size: 17px; line-height: 1.5; }
            .sort-container {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
                padding: 16px 20px;
            }
            .sort-container label { font-size: 18px; }
            .sort-container select {
                width: 100%;
                padding: 16px;
                font-size: 18px;
            }
            .moderation-tabs {
                flex-direction: row;
                width: 100%;
                justify-content: center;
                gap: 6px;
            }
            .moderation-tabs button {
                flex: 1;
                text-align: center;
                padding: 16px 6px;
                font-size: 16px;
            }
            .theme-toggle {
                width: 52px;
                height: 52px;
                font-size: 26px;
                bottom: 12px;
                right: 12px;
            }
        }

        @media (max-width: 480px) {
            .sidebar button {
                min-width: 90px;
                font-size: 15px;
                padding: 14px 6px;
            }
            h1 { font-size: 28px; }
            h2 { font-size: 22px; }
            .stats { font-size: 16px; }
            .content { padding: 20px; }
            .result-item { padding: 20px; }
        }

        @media (max-width: 360px) {
            .sidebar button {
                min-width: 75px;
                font-size: 13px;
                padding: 12px 4px;
            }
            h1 { font-size: 24px; }
        }
    </style>
</head>
<body>
    <div class="theme-toggle" id="themeToggle">üåô</div>
    <div class="container">
        <div class="sidebar">
            <button id="btnHome" class="active">üè† –ì–ª–∞–≤–Ω–∞—è</button>
            <button id="btnSend">üìù –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            <button id="btnSearch">üîç –ü–æ–∏—Å–∫</button>
            <div class="moderation-circle" id="btnModeration" title="–ü–∞–Ω–µ–ª—å –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞">üëÆ</div>
        </div>
        <div class="content" id="content"></div>
    </div>

    <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –ø–∞—Å—Ö–∞–ª–∫–∏ -->
    <img src="19.png" id="egg1" class="easter-egg-img" alt="Easter egg 1">
    <img src="20.png" id="egg2" class="easter-egg-img" alt="Easter egg 2">

    <!-- –ê—É–¥–∏–æ –¥–ª—è –ø–∞—Å—Ö–∞–ª–∫–∏ -->
    <audio id="easterAudio" src="machomen.mp3" preload="auto"></audio>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥ Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBw8OCvgXEqj0ZVPuFMMg3DTR5BfpYnNKk",
            authDomain: "marta-ebc25.firebaseapp.com",
            projectId: "marta-ebc25",
            storageBucket: "marta-ebc25.firebasestorage.app",
            messagingSenderId: "659204675048",
            appId: "1:659204675048:web:b9e6b6f414439e5aa3005d"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        db.enablePersistence().catch(err => console.log("–û—à–∏–±–∫–∞ persistence:", err));

        (function() {
            const contentDiv = document.getElementById('content');
            const btnHome = document.getElementById('btnHome');
            const btnSend = document.getElementById('btnSend');
            const btnSearch = document.getElementById('btnSearch');
            const btnModeration = document.getElementById('btnModeration');
            const themeToggle = document.getElementById('themeToggle');

            // –ú–∞—Å—Å–∏–≤ email-–∞–¥—Ä–µ—Å–æ–≤ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤
            const MODERATOR_EMAILS = [
                'yurapon11972020@gmail.com',
                'yraslavskibididobi@mail.ru',
                'iluhamoder@mail.ru',
                'danilsupervpn@mail.ru',
                'skvizzymedium@mail.ru'
            ].map(email => email.toLowerCase());

            const POST_COOLDOWN = 5 * 60 * 1000;

            // –ü–∞—Å—Ö–∞–ª–∫–∞
            let clickCount = 0;
            let firstClickTime = 0;
            let easterEggActive = false;
            let currentEggIndex = 1; // 1 –∏–ª–∏ 2 –¥–ª—è —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏—è

            const audio = document.getElementById('easterAudio');
            const egg1 = document.getElementById('egg1');
            const egg2 = document.getElementById('egg2');

            function showEasterEgg() {
                if (easterEggActive) return;
                easterEggActive = true;

                // –í—ã–±–∏—Ä–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Ñ–æ—Ç–æ
                const currentEgg = currentEggIndex === 1 ? egg1 : egg2;
                const nextIndex = currentEggIndex === 1 ? 2 : 1;

                // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∫–ª–∞—Å—Å—ã
                currentEgg.classList.remove('hide', 'show');
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ç–æ (–±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è)
                currentEgg.style.display = 'block';
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π reflow –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è display
                void currentEgg.offsetWidth;
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å show (opacity 1) ‚Äî –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ä–µ–∑–∫–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ transition –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø–æ—è–≤–ª–µ–Ω–∏–µ, —Ç–æ–ª—å–∫–æ –Ω–∞ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ
                currentEgg.classList.add('show');

                // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –º—É–∑—ã–∫—É
                audio.currentTime = 0;
                audio.play().catch(e => console.log("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∞—É–¥–∏–æ:", e));

                // –ß–µ—Ä–µ–∑ 4.5 —Å–µ–∫—É–Ω–¥—ã –Ω–∞—á–∏–Ω–∞–µ–º –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ
                setTimeout(() => {
                    currentEgg.classList.remove('show');
                    currentEgg.classList.add('hide'); // –∑–∞–ø—É—Å–∫–∞–µ—Ç transition –Ω–∞ opacity
                }, 4500);

                // –ß–µ—Ä–µ–∑ 6 —Å–µ–∫—É–Ω–¥ (4.5 + 1.5) –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã–≤–∞–µ–º –∏ —Ä–∞–∑—Ä–µ—à–∞–µ–º —Å–ª–µ–¥—É—é—â–µ–µ —Ñ–æ—Ç–æ
                setTimeout(() => {
                    currentEgg.style.display = 'none';
                    currentEgg.classList.remove('hide');
                    easterEggActive = false;
                    currentEggIndex = nextIndex; // –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–µ —Ñ–æ—Ç–æ
                }, 6000);
            }

            // –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫—É —Ç–µ–º—ã
            themeToggle.addEventListener('click', (e) => {
                // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ (—Å–º–µ–Ω–∞ —Ç–µ–º—ã)
                let darkTheme = localStorage.getItem('theme') === 'dark';
                darkTheme = !darkTheme;
                document.body.classList.toggle('dark-theme', darkTheme);
                localStorage.setItem('theme', darkTheme ? 'dark' : 'light');
                themeToggle.textContent = darkTheme ? '‚òÄÔ∏è' : 'üåô';

                // –ü–∞—Å—Ö–∞–ª–∫–∞: —Å—á–∏—Ç–∞–µ–º –∫–ª–∏–∫–∏
                const now = Date.now();
                if (firstClickTime === 0 || now - firstClickTime > 2000) {
                    clickCount = 1;
                    firstClickTime = now;
                } else {
                    clickCount++;
                    if (clickCount >= 5 && !easterEggActive) {
                        showEasterEgg();
                        clickCount = 0;
                        firstClickTime = 0;
                    }
                }

                // –í—Ä–∞—â–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏
                themeToggle.style.transform = 'rotate(360deg)';
                setTimeout(() => themeToggle.style.transform = '', 300);
            });

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã
            let darkTheme = localStorage.getItem('theme') === 'dark';
            if (darkTheme) {
                document.body.classList.add('dark-theme');
                themeToggle.textContent = '‚òÄÔ∏è';
            } else {
                themeToggle.textContent = 'üåô';
            }

            function showHeartAnimation() {
                for (let i = 0; i < 10; i++) {
                    setTimeout(() => {
                        const heart = document.createElement('div');
                        heart.className = 'heart-animation';
                        heart.innerHTML = '‚ù§Ô∏è';
                        heart.style.left = Math.random() * 100 + '%';
                        heart.style.top = Math.random() * 100 + '%';
                        document.body.appendChild(heart);
                        setTimeout(() => heart.remove(), 2000);
                    }, i * 100);
                }
            }

            function isAdmin() {
                const user = auth.currentUser;
                return user && MODERATOR_EMAILS.includes(user.email.toLowerCase());
            }

            function getLastPostTime() {
                const time = localStorage.getItem('lastPostTime');
                return time ? parseInt(time, 10) : 0;
            }

            function setLastPostTime() {
                localStorage.setItem('lastPostTime', Date.now().toString());
            }

            function canPost() {
                if (isAdmin()) return true;
                const last = getLastPostTime();
                return (Date.now() - last) >= POST_COOLDOWN;
            }

            function getRemainingSeconds() {
                if (isAdmin()) return 0;
                const last = getLastPostTime();
                const diff = POST_COOLDOWN - (Date.now() - last);
                return diff > 0 ? Math.ceil(diff / 1000) : 0;
            }

            async function logModeratorAction(action, details, docId = null) {
                if (!isAdmin()) return;
                try {
                    await db.collection('logs').add({
                        moderator: auth.currentUser.email,
                        action: action,
                        details: details,
                        documentId: docId,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } catch (e) {
                    console.error("–û—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:", e);
                }
            }

            async function getStats() {
                const totalSnap = await db.collection('congratulations').get();
                const approvedSnap = await db.collection('congratulations').where('approved', '==', true).get();
                return { total: totalSnap.size, approved: approvedSnap.size };
            }

            async function addCongratulation(from, to, category, message) {
                try {
                    const docRef = await db.collection('congratulations').add({
                        from, to, category, message,
                        date: firebase.firestore.FieldValue.serverTimestamp(),
                        approved: false,
                        likes: 0
                    });
                    return { success: true, id: docRef.id };
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: ", error);
                    return { success: false };
                }
            }

            async function loadRecentApproved(lastDoc = null) {
                try {
                    let query = db.collection('congratulations')
                        .where('approved', '==', true)
                        .orderBy('date', 'desc')
                        .limit(10);
                    if (lastDoc) query = query.startAfter(lastDoc);
                    const snapshot = await query.get();
                    const last = snapshot.docs[snapshot.docs.length - 1];
                    const results = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    return { results, last };
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö: ", error);
                    return { results: [], last: null };
                }
            }

            async function loadAllApproved(forceRefresh = false) {
                try {
                    let query = db.collection('congratulations').where('approved', '==', true);
                    let snapshot;
                    if (forceRefresh) {
                        snapshot = await query.get({ source: 'server' });
                    } else {
                        snapshot = await query.get();
                    }
                    localStorage.setItem('lastUpdate', Date.now().toString());
                    return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π: ", error);
                    return [];
                }
            }

            async function getUnapprovedCongrats() {
                try {
                    const snapshot = await db.collection('congratulations').where('approved', '==', false).get();
                    return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–µ–æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö: ", error);
                    return [];
                }
            }

            async function getAllCongrats() {
                try {
                    const snapshot = await db.collection('congratulations').orderBy('date', 'desc').limit(50).get();
                    return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π: ", error);
                    return [];
                }
            }

            async function updateCongratulation(id, data) {
                await db.collection('congratulations').doc(id).update(data);
            }

            async function deleteCongratulation(id) {
                await db.collection('congratulations').doc(id).delete();
            }

            async function likeCongratulation(id) {
                await db.collection('congratulations').doc(id).update({
                    likes: firebase.firestore.FieldValue.increment(1)
                });
            }

            function sortCongrats(items, sortBy) {
                const sorted = [...items];
                switch (sortBy) {
                    case 'date_desc':
                        sorted.sort((a, b) => (b.date?.seconds || 0) - (a.date?.seconds || 0));
                        break;
                    case 'date_asc':
                        sorted.sort((a, b) => (a.date?.seconds || 0) - (b.date?.seconds || 0));
                        break;
                    case 'likes_desc':
                        sorted.sort((a, b) => (b.likes || 0) - (a.likes || 0));
                        break;
                    case 'likes_asc':
                        sorted.sort((a, b) => (a.likes || 0) - (b.likes || 0));
                        break;
                    case 'from_asc':
                        sorted.sort((a, b) => (a.from || '').localeCompare(b.from || ''));
                        break;
                    case 'from_desc':
                        sorted.sort((a, b) => (b.from || '').localeCompare(a.from || ''));
                        break;
                    case 'to_asc':
                        sorted.sort((a, b) => (a.to || '').localeCompare(b.to || ''));
                        break;
                    case 'to_desc':
                        sorted.sort((a, b) => (b.to || '').localeCompare(a.to || ''));
                        break;
                    default:
                        sorted.sort((a, b) => (b.date?.seconds || 0) - (a.date?.seconds || 0));
                }
                return sorted;
            }

            function setActiveButton(activeId) {
                [btnHome, btnSend, btnSearch].forEach(btn => btn.classList.remove('active'));
                if (activeId !== 'btnModeration') {
                    document.getElementById(activeId).classList.add('active');
                }
                btnModeration.classList.remove('active');
            }

            async function renderHome() {
                setActiveButton('btnHome');
                const stats = await getStats();
                contentDiv.innerHTML = `
                    <h1>üå∏ –ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è —Å 8 –º–∞—Ä—Ç–∞</h1>
                    <div class="stats">
                        <span>üì® –í—Å–µ–≥–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: ${stats.total}</span>
                        <span>‚úÖ –û–¥–æ–±—Ä–µ–Ω–æ: ${stats.approved}</span>
                    </div>
                    <div class="rules">
                        <strong>–ü—Ä–∞–≤–∏–ª–∞:</strong>
                        <ul style="margin-top:10px; margin-left:20px;">
                            <li>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ.</li>
                            <li>–£–∫–∞–∂–∏—Ç–µ, –æ—Ç –∫–æ–≥–æ –∏ –∫–æ–º—É (–∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é).</li>
                            <li>–í—Å–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ö–æ–¥—è—Ç –º–æ–¥–µ—Ä–∞—Ü–∏—é –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π.</li>
                            <li>–û–¥–Ω–æ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–µ —á–∞—â–µ, —á–µ–º —Ä–∞–∑ –≤ 5 –º–∏–Ω—É—Ç.</li>
                        </ul>
                    </div>
                    <h2>üì¨ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
                    <div id="recentResults" class="search-hint">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    <button id="loadMoreRecentBtn" class="load-more" style="display:none;">–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â—ë</button>
                `;

                const recentDiv = document.getElementById('recentResults');
                const loadMoreBtn = document.getElementById('loadMoreRecentBtn');
                let lastDoc = null;

                async function loadRecent(reset = true) {
                    if (reset) {
                        lastDoc = null;
                        recentDiv.innerHTML = '<div class="search-hint">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
                    }
                    const data = await loadRecentApproved(lastDoc);
                    if (data.results.length === 0 && reset) {
                        recentDiv.innerHTML = '<div class="no-results">üòî –ü–æ–∫–∞ –Ω–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–π.</div>';
                        loadMoreBtn.style.display = 'none';
                    } else {
                        if (reset) recentDiv.innerHTML = '';
                        data.results.forEach((item, index) => {
                            const d = item.date ? new Date(item.date.seconds * 1000).toLocaleString() : '';
                            recentDiv.innerHTML += `
                                <div class="result-item" style="animation-delay: ${index * 0.1}s">
                                    <p><strong>–û—Ç –∫–æ–≥–æ:</strong> ${item.from}</p>
                                    <p><strong>–ö–æ–º—É:</strong> ${item.to} (${item.category === 'teacher' ? 'üë©‚Äçüè´' : 'üë•'})</p>
                                    <p><strong>–¢–µ–∫—Å—Ç:</strong> ${item.message}</p>
                                    <small>${d} | ‚ù§Ô∏è ${item.likes || 0}</small>
                                    <br>
                                    <button class="like-btn" data-id="${item.id}">‚ù§Ô∏è –ù—Ä–∞–≤–∏—Ç—Å—è</button>
                                    <button class="share-btn" data-id="${item.id}" data-to="${item.to}">üîó –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
                                </div>
                            `;
                        });
                        lastDoc = data.last;
                        loadMoreBtn.style.display = data.last ? 'block' : 'none';

                        document.querySelectorAll('#recentResults .like-btn').forEach(btn => {
                            btn.addEventListener('click', async (e) => {
                                const id = e.target.dataset.id;
                                await likeCongratulation(id);
                                e.target.disabled = true;
                                e.target.textContent = '‚ù§Ô∏è –°–ø–∞—Å–∏–±–æ!';
                            });
                        });
                        document.querySelectorAll('#recentResults .share-btn').forEach(btn => {
                            btn.addEventListener('click', (e) => {
                                const id = e.target.dataset.id;
                                const to = e.target.dataset.to;
                                const url = window.location.href.split('#')[0] + '#congratulation=' + id;
                                const text = `–ù–∞–ø–∏—à–∏ ${to} —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è ${url}`;
                                navigator.clipboard.writeText(text);
                                alert('–°—Å—ã–ª–∫–∞ —Å –∏–º–µ–Ω–µ–º —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
                            });
                        });
                    }
                }

                loadMoreBtn.addEventListener('click', () => loadRecent(false));
                await loadRecent(true);
            }

            function renderSend() {
                setActiveButton('btnSend');
                contentDiv.innerHTML = `
                    <h2>‚úçÔ∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
                    <form id="greetingForm">
                        <div class="form-group">
                            <label for="from">–û—Ç –∫–æ–≥–æ (–≤–∞—à–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—è):</label>
                            <input type="text" id="from" required placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤">
                        </div>
                        <div class="form-group">
                            <label for="to">–ö–æ–º—É (–∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è):</label>
                            <input type="text" id="to" required placeholder="–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞">
                        </div>
                        <div class="form-group">
                            <label for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è:</label>
                            <select id="category" required>
                                <option value="teacher">üë©‚Äçüè´ –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</option>
                                <option value="classmate">üë• –û–¥–Ω–æ–≥—Ä—É–ø–ø–Ω–∏–∫</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="message">–¢–µ–∫—Å—Ç –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è:</label>
                            <textarea id="message" required placeholder="–° 8 –º–∞—Ä—Ç–∞! –ñ–µ–ª–∞—é —Å—á–∞—Å—Ç—å—è..."></textarea>
                        </div>
                        <button type="submit" id="submitBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é üíê</button>
                        <div id="formMessage" class="message"></div>
                        <div id="timerMessage" class="timer-message"></div>
                    </form>
                `;

                const form = document.getElementById('greetingForm');
                const submitBtn = document.getElementById('submitBtn');
                const msg = document.getElementById('formMessage');
                const timerMsg = document.getElementById('timerMessage');

                function updateButtonState() {
                    if (canPost()) {
                        submitBtn.disabled = false;
                        timerMsg.textContent = '';
                    } else {
                        submitBtn.disabled = true;
                        const sec = getRemainingSeconds();
                        timerMsg.textContent = `‚è≥ –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —á–µ—Ä–µ–∑ ${sec} —Å–µ–∫.`;
                    }
                }

                const timerInterval = setInterval(updateButtonState, 1000);
                updateButtonState();

                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const from = document.getElementById('from').value.trim();
                    const to = document.getElementById('to').value.trim();
                    const category = document.getElementById('category').value;
                    const message = document.getElementById('message').value.trim();

                    if (!from || !to || !message) {
                        msg.className = 'message error';
                        msg.textContent = '–í—Å–µ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã!';
                        msg.style.display = 'block';
                        return;
                    }

                    if (!canPost()) {
                        msg.className = 'message error';
                        msg.textContent = '–ü–æ–¥–æ–∂–¥–∏—Ç–µ 5 –º–∏–Ω—É—Ç –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π –æ—Ç–ø—Ä–∞–≤–∫–æ–π.';
                        msg.style.display = 'block';
                        return;
                    }

                    const result = await addCongratulation(from, to, category, message);
                    if (result.success) {
                        form.reset();
                        setLastPostTime();
                        updateButtonState();
                        msg.className = 'message success';
                        msg.textContent = '–ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é! üíñ';
                        msg.style.display = 'block';
                        showHeartAnimation();
                        setTimeout(() => msg.style.display = 'none', 3000);
                    } else {
                        msg.className = 'message error';
                        msg.textContent = '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.';
                        msg.style.display = 'block';
                    }
                });
            }

            function renderSearch() {
                setActiveButton('btnSearch');
                contentDiv.innerHTML = `
                    <h1>üîé –í—Å–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;">
                        <div>
                            <span id="lastUpdateLabel"></span>
                            <button id="refreshDataBtn" class="load-more" style="width: auto; padding: 8px 15px; margin: 0;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                        </div>
                    </div>
                    <div class="search-container">
                        <input type="text" id="searchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è –¥–ª—è –ø–æ–∏—Å–∫–∞ (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ)">
                        <button class="search-btn" id="searchBtn">–ù–∞–π—Ç–∏</button>
                    </div>
                    <div class="sort-container">
                        <label for="searchSort">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å:</label>
                        <select id="searchSort">
                            <option value="date_desc">–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
                            <option value="date_asc">–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
                            <option value="likes_desc">–ü–æ –ª–∞–π–∫–∞–º (—Å–Ω–∞—á–∞–ª–∞ –±–æ–ª—å—à–µ)</option>
                            <option value="likes_asc">–ü–æ –ª–∞–π–∫–∞–º (—Å–Ω–∞—á–∞–ª–∞ –º–µ–Ω—å—à–µ)</option>
                            <option value="from_asc">–ü–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é (–ê-–Ø)</option>
                            <option value="from_desc">–ü–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é (–Ø-–ê)</option>
                            <option value="to_asc">–ü–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—é (–ê-–Ø)</option>
                            <option value="to_desc">–ü–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—é (–Ø-–ê)</option>
                        </select>
                    </div>
                    <div id="searchResults" class="search-hint">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    <button id="loadMoreBtn" class="load-more" style="display:none;">–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â—ë</button>
                `;

                const input = document.getElementById('searchInput');
                const btn = document.getElementById('searchBtn');
                const results = document.getElementById('searchResults');
                const loadMore = document.getElementById('loadMoreBtn');
                const sortSelect = document.getElementById('searchSort');
                const refreshBtn = document.getElementById('refreshDataBtn');
                const lastUpdateLabel = document.getElementById('lastUpdateLabel');

                let allItems = [];
                let displayedCount = 0;
                let currentQuery = '';
                let currentSort = sortSelect.value;

                function updateLastUpdateLabel() {
                    const lastUpdate = localStorage.getItem('lastUpdate');
                    if (lastUpdate) {
                        const date = new Date(parseInt(lastUpdate));
                        lastUpdateLabel.textContent = `üìÖ –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${date.toLocaleString()}`;
                    } else {
                        lastUpdateLabel.textContent = '';
                    }
                }
                updateLastUpdateLabel();

                function displayItems() {
                    let filtered = allItems;
                    if (currentQuery.trim() !== '') {
                        const lower = currentQuery.toLowerCase();
                        filtered = allItems.filter(item => item.to.toLowerCase().includes(lower));
                    }
                    const sorted = sortCongrats(filtered, currentSort);

                    if (sorted.length === 0) {
                        results.innerHTML = `<div class="no-results">üòî –ü–æ –∑–∞–ø—Ä–æ—Å—É ¬´${currentQuery || '–≤—Å–µ'}¬ª –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</div>`;
                        loadMore.style.display = 'none';
                        return;
                    }

                    const toShow = sorted.slice(0, displayedCount);
                    let html = '';
                    toShow.forEach((item, index) => {
                        const d = item.date ? new Date(item.date.seconds * 1000).toLocaleString() : '';
                        html += `
                            <div class="result-item" style="animation-delay: ${index * 0.1}s">
                                <p><strong>–û—Ç –∫–æ–≥–æ:</strong> ${item.from}</p>
                                <p><strong>–ö–æ–º—É:</strong> ${item.to} (${item.category === 'teacher' ? 'üë©‚Äçüè´' : 'üë•'})</p>
                                <p><strong>–¢–µ–∫—Å—Ç:</strong> ${item.message}</p>
                                <small>${d} | ‚ù§Ô∏è ${item.likes || 0}</small>
                                <br>
                                <button class="like-btn" data-id="${item.id}">‚ù§Ô∏è –ù—Ä–∞–≤–∏—Ç—Å—è</button>
                                <button class="share-btn" data-id="${item.id}" data-to="${item.to}">üîó –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
                            </div>
                        `;
                    });
                    results.innerHTML = html;

                    if (displayedCount < sorted.length) {
                        loadMore.style.display = 'block';
                    } else {
                        loadMore.style.display = 'none';
                    }

                    document.querySelectorAll('.like-btn').forEach(btn => {
                        btn.addEventListener('click', async (e) => {
                            const id = e.target.dataset.id;
                            await likeCongratulation(id);
                            e.target.disabled = true;
                            e.target.textContent = '‚ù§Ô∏è –°–ø–∞—Å–∏–±–æ!';
                        });
                    });
                    document.querySelectorAll('.share-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const id = e.target.dataset.id;
                            const to = e.target.dataset.to;
                            const url = window.location.href.split('#')[0] + '#congratulation=' + id;
                            const text = `–ù–∞–ø–∏—à–∏ ${to} —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è ${url}`;
                            navigator.clipboard.writeText(text);
                            alert('–°—Å—ã–ª–∫–∞ —Å –∏–º–µ–Ω–µ–º —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
                        });
                    });
                }

                async function loadAllData(forceRefresh = false) {
                    results.innerHTML = '<div class="search-hint">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
                    allItems = await loadAllApproved(forceRefresh);
                    displayedCount = 10;
                    displayItems();
                    updateLastUpdateLabel();
                }

                input.addEventListener('input', () => {
                    currentQuery = input.value.trim();
                    displayedCount = 10;
                    displayItems();
                });

                btn.addEventListener('click', () => {
                    currentQuery = input.value.trim();
                    displayedCount = 10;
                    displayItems();
                });

                sortSelect.addEventListener('change', () => {
                    currentSort = sortSelect.value;
                    displayedCount = 10;
                    displayItems();
                });

                loadMore.addEventListener('click', () => {
                    displayedCount += 10;
                    displayItems();
                });

                refreshBtn.addEventListener('click', () => {
                    loadAllData(true);
                });

                loadAllData(false);
            }

            async function renderModeration() {
                if (!isAdmin()) {
                    contentDiv.innerHTML = `
                        <div class="admin-login">
                            <h2>üîê –í—Ö–æ–¥ –¥–ª—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞</h2>
                            <input type="email" id="adminEmail" placeholder="Email" value="">
                            <input type="password" id="adminPass" placeholder="–ü–∞—Ä–æ–ª—å">
                            <button id="loginAdminBtn">–í–æ–π—Ç–∏</button>
                            <div id="loginMessage"></div>
                        </div>
                    `;

                    document.getElementById('loginAdminBtn').addEventListener('click', () => {
                        const email = document.getElementById('adminEmail').value;
                        const pass = document.getElementById('adminPass').value;
                        auth.signInWithEmailAndPassword(email, pass)
                            .then(() => {
                                renderModeration();
                            })
                            .catch(error => {
                                document.getElementById('loginMessage').textContent = '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message;
                            });
                    });
                    return;
                }

                let html = `
                    <div class="moderation-header">
                        <h2>üõ°Ô∏è –ü–∞–Ω–µ–ª—å –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞</h2>
                        <button class="logout-btn" id="logoutBtn">üö™ –í—ã–π—Ç–∏</button>
                    </div>
                    <div class="moderation-tabs">
                        <button id="tabNew" class="active-tab">üì¨ –ù–æ–≤—ã–µ</button>
                        <button id="tabAll">üìã –í—Å–µ –∑–∞–ø–∏—Å–∏</button>
                    </div>
                    <div id="moderationContent"></div>
                `;
                contentDiv.innerHTML = html;

                document.getElementById('logoutBtn').addEventListener('click', () => {
                    auth.signOut().then(() => {
                        renderModeration();
                    });
                });

                const modContent = document.getElementById('moderationContent');
                const tabNew = document.getElementById('tabNew');
                const tabAll = document.getElementById('tabAll');

                function setActiveTab(tab) {
                    [tabNew, tabAll].forEach(b => b.classList.remove('active-tab'));
                    if (tab === 'new') {
                        tabNew.classList.add('active-tab');
                        loadNew();
                    } else {
                        tabAll.classList.add('active-tab');
                        loadAll();
                    }
                }

                async function loadNew() {
                    const items = await getUnapprovedCongrats();
                    renderItems(items, 'new');
                }

                async function loadAll() {
                    const items = await getAllCongrats();
                    renderItems(items, 'all');
                }

                function renderItems(items, type) {
                    if (items.length === 0) {
                        modContent.innerHTML = '<p class="no-results">‚ú® –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</p>';
                        return;
                    }

                    let out = '';
                    items.forEach((item, index) => {
                        const dateStr = item.date ? new Date(item.date.seconds * 1000).toLocaleString() : '';
                        const approvedStatus = item.approved ? '‚úÖ –û–¥–æ–±—Ä–µ–Ω–æ' : '‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏';

                        out += `
                            <div class="result-item" data-id="${item.id}" style="animation-delay: ${index * 0.1}s">
                                <div class="item-view">
                                    <p><strong>–û—Ç:</strong> <span class="from-text">${item.from}</span></p>
                                    <p><strong>–ö–æ–º—É:</strong> <span class="to-text">${item.to} (${item.category === 'teacher' ? 'üë©‚Äçüè´' : 'üë•'})</span></p>
                                    <p><strong>–¢–µ–∫—Å—Ç:</strong> <span class="msg-text">${item.message}</span></p>
                                    <p><small>${dateStr} | ${approvedStatus} | ‚ù§Ô∏è ${item.likes || 0}</small></p>
                                    <button class="edit-btn" data-id="${item.id}">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                    <button class="delete-btn" data-id="${item.id}">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                                    ${!item.approved ? `<button class="approve-btn" data-id="${item.id}">‚úÖ –û–¥–æ–±—Ä–∏—Ç—å</button>` : ''}
                                </div>
                                <div class="item-edit" style="display:none;">
                                    <input class="inline-edit-input edit-from" value="${item.from.replace(/"/g, '&quot;')}">
                                    <input class="inline-edit-input edit-to" value="${item.to.replace(/"/g, '&quot;')}">
                                    <input class="inline-edit-input edit-category" value="${item.category || 'teacher'}">
                                    <textarea class="inline-edit-input edit-msg">${item.message.replace(/"/g, '&quot;')}</textarea>
                                    <button class="save-btn" data-id="${item.id}">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                                    <button class="cancel-btn">‚ùå –û—Ç–º–µ–Ω–∞</button>
                                </div>
                            </div>
                        `;
                    });

                    modContent.innerHTML = out;

                    document.querySelectorAll('.edit-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const card = e.target.closest('.result-item');
                            card.querySelector('.item-view').style.display = 'none';
                            card.querySelector('.item-edit').style.display = 'block';
                        });
                    });

                    document.querySelectorAll('.cancel-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const card = e.target.closest('.result-item');
                            card.querySelector('.item-view').style.display = 'block';
                            card.querySelector('.item-edit').style.display = 'none';
                        });
                    });

                    document.querySelectorAll('.save-btn').forEach(btn => {
                        btn.addEventListener('click', async (e) => {
                            const card = e.target.closest('.result-item');
                            const id = card.dataset.id;
                            const from = card.querySelector('.edit-from').value.trim();
                            const to = card.querySelector('.edit-to').value.trim();
                            const category = card.querySelector('.edit-category').value.trim();
                            const msg = card.querySelector('.edit-msg').value.trim();

                            if (!from || !to || !msg) {
                                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                                return;
                            }

                            await updateCongratulation(id, { from, to, category, message: msg });
                            await logModeratorAction('edit', `–ò–∑–º–µ–Ω–∏–ª –∑–∞–ø–∏—Å—å ${id}`, id);
                            if (type === 'new') loadNew(); else loadAll();
                        });
                    });

                    document.querySelectorAll('.delete-btn').forEach(btn => {
                        btn.addEventListener('click', async (e) => {
                            const id = e.target.dataset.id;
                            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ?')) {
                                await deleteCongratulation(id);
                                await logModeratorAction('delete', `–£–¥–∞–ª–∏–ª –∑–∞–ø–∏—Å—å ${id}`, id);
                                if (type === 'new') loadNew(); else loadAll();
                            }
                        });
                    });

                    document.querySelectorAll('.approve-btn').forEach(btn => {
                        btn.addEventListener('click', async (e) => {
                            const id = e.target.dataset.id;
                            await updateCongratulation(id, { approved: true });
                            await logModeratorAction('approve', `–û–¥–æ–±—Ä–∏–ª –∑–∞–ø–∏—Å—å ${id}`, id);
                            if (type === 'new') loadNew(); else loadAll();
                        });
                    });
                }

                tabNew.addEventListener('click', () => setActiveTab('new'));
                tabAll.addEventListener('click', () => setActiveTab('all'));

                setActiveTab('new');
            }

            auth.onAuthStateChanged(user => {});

            btnHome.addEventListener('click', renderHome);
            btnSend.addEventListener('click', renderSend);
            btnSearch.addEventListener('click', renderSearch);
            btnModeration.addEventListener('click', renderModeration);

            renderHome();
        })();
    </script>
</body>
</html>